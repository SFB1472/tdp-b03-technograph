<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Context of traces – Fieldnotes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-bcb4737e8fbcf1e9dfc00b59f8305558.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../sites/pipeline/pipeline.html">Pipeline: data processing</a></li><li class="breadcrumb-item"><a href="../../sites/pipeline/create-traces-context-tbl.html">4. db tabelle: traces context</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Fieldnotes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Basics: data export from the internet archive</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/datengrundlage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data basis: sampling and structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/script-files-to-html-pages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Matching scripts files to html pages</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Pipeline: data processing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Erläuterung Pipeline</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. db tabelle: sites - Data cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/data-cleaning-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Erweiterung der ersten Tabelle: second export</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/create-tags-tbl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. db-tabelle: tags</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/doc-parsing-failure-tags-tbl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">intermezzo: dokumentation des parsing fehlers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/create-traces-tbl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 db tabelle: traces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/create-context-pathes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">intermezzo: zwischenschritte zur vierten tabelle</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/create-traces-context-tbl.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">4. db tabelle: traces context</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/pipeline/create-traces-hashes-tbl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 db tabelle: hashes</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Analysing: How to find commenting possibilities in HTML?</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/approaches.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Different approaches how to interpret HTML</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/analyzing-doctypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzing doctype</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/analyzing-form-tags.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzing form tags</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/form-context.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Context of form tags</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/analyzing-script-tags.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzing script tags</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/analyzing-iframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzing iframes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/analyzing-all-tags.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analyzing specific snippets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/commenting-traces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">All commenting traces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/tag-context.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Context of all traces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sites/understanding-hashes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding the Hashes</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#info" id="toc-info" class="nav-link active" data-scroll-target="#info">Info</a></li>
  <li><a href="#input" id="toc-input" class="nav-link" data-scroll-target="#input">Input</a></li>
  <li><a href="#tests" id="toc-tests" class="nav-link" data-scroll-target="#tests">Tests</a></li>
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations">Transformations</a>
  <ul class="collapse">
  <li><a href="#group-variable-for-site-tag-group" id="toc-group-variable-for-site-tag-group" class="nav-link" data-scroll-target="#group-variable-for-site-tag-group">group variable for site-tag-group</a></li>
  <li><a href="#group-variable-for-month-site-subdomain" id="toc-group-variable-for-month-site-subdomain" class="nav-link" data-scroll-target="#group-variable-for-month-site-subdomain">group variable for month-site-subdomain</a></li>
  <li><a href="#cleaned-value-count-based" id="toc-cleaned-value-count-based" class="nav-link" data-scroll-target="#cleaned-value-count-based">cleaned value count-based</a></li>
  <li><a href="#cleaned-value-whitelist-approach" id="toc-cleaned-value-whitelist-approach" class="nav-link" data-scroll-target="#cleaned-value-whitelist-approach">cleaned value whitelist approach</a></li>
  <li><a href="#cleaned-pathes-on-whitelist-value-cleaned" id="toc-cleaned-pathes-on-whitelist-value-cleaned" class="nav-link" data-scroll-target="#cleaned-pathes-on-whitelist-value-cleaned">cleaned pathes on whitelist value cleaned</a></li>
  </ul></li>
  <li><a href="#output" id="toc-output" class="nav-link" data-scroll-target="#output">Output</a></li>
  <li><a href="#appendix-schritte-zur-überprüfungen-erster-parsing-ansätze." id="toc-appendix-schritte-zur-überprüfungen-erster-parsing-ansätze." class="nav-link" data-scroll-target="#appendix-schritte-zur-überprüfungen-erster-parsing-ansätze.">Appendix: Schritte zur Überprüfungen erster Parsing-Ansätze.</a>
  <ul class="collapse">
  <li><a href="#erste-variante-von-vereinfachten-pfaden-cleaned-pathes-of-tags" id="toc-erste-variante-von-vereinfachten-pfaden-cleaned-pathes-of-tags" class="nav-link" data-scroll-target="#erste-variante-von-vereinfachten-pfaden-cleaned-pathes-of-tags">Erste Variante von vereinfachten Pfaden: cleaned pathes of tags</a></li>
  </ul></li>
  <li><a href="#parsing-test-context" id="toc-parsing-test-context" class="nav-link" data-scroll-target="#parsing-test-context">Parsing Test context</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../sites/pipeline/pipeline.html">Pipeline: data processing</a></li><li class="breadcrumb-item"><a href="../../sites/pipeline/create-traces-context-tbl.html">4. db tabelle: traces context</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Context of traces</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urltools)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../config/config-graphic.R"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../config/config.R"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># source("../../config/config-secret.R")</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># con_remote &lt;- dbConnect(RPostgres::Postgres(), </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                  dbname = dsn_database,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                  host = dsn_hostname, </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                  port = dsn_port,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                  user = dsn_uid, </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                  password = dsn_pwd</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../config/config-secret-local.R"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>con_local <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(), </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> dsn_database,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host =</span> dsn_hostname, </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">port =</span> dsn_port,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user =</span> dsn_uid, </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password =</span> dsn_pwd</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="info" class="level2">
<h2 class="anchored" data-anchor-id="info">Info</h2>
<p>Bezug zu Script 1-parsing/analyse-tag-context.R Dieses Script baute auf analyse-form-context.R auf. Das war der Prototyp für die Idee, den Kontext der Spuren mit zu berücksichtigen. Fieseste Umwandlung bis Daten in die Datenbank kommen, weil das cleaning richtig ätzend qualitativ abläuft.</p>
<p>In diesem Prozessschritt werden die Daten aus dem zweiten pythonscript eingelesen (und überprüft?). Die Tabelle <code>trace_context</code> ist diejenige, auf deren Grundlage in einem weiteren Schritt verschiedene Hashes berechnet werden. Erläuterungen dazu auf dieser Seite (to do: verlinken).</p>
<p>Zur Vorbereitung auf den weiteren Verarbeitungsschritt, werden die geparsten Daten hier um einige Werte erweitert. Es kommen zwei Gruppenvariablen hinzu, sowie vereinfachte Werte für die Spalte <code>value</code>.</p>
</section>
<section id="input" class="level2">
<h2 class="anchored" data-anchor-id="input">Input</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Verbesserung im Vergleich zu den form tags: Es gibt jetzt schon eine Gruppenvariable aus dem Parsing</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">#### in der Datenbank gibt es eine Spalte of_interest in der sites tabelle, so fallen hier einige Schritte raus.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>SPHERE_FOR_SHEET <span class="ot">&lt;-</span> <span class="st">"Dutch"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>better_path <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags/"</span>, SPHERE_FOR_SHEET, <span class="st">"/25-11-27-tag-context-parsing.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sha1, path, attrs) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>df_tags_context_ <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/"</span>, SPHERE_FOR_SHEET, <span class="st">"/25-11-27-context-all-traces.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bind_rows(., read_csv(file = paste0("data/1-parsing/tags-context/", SPHERE_FOR_SHEET, "/context-all-traces-2.csv"), show_col_types = FALSE)) %&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">...1</span><span class="st">`</span>) <span class="co">#%&gt;%</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## eigener Abschnitt für World, weil es hier während des context parsen zu einer Unterbrechung kam. Deswegen gibt es zwei Dateien</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>better_path <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags/World/25-11-28-tag-context-parsing.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sha1, path, attrs) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df_tags_context_ <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/World/25-11-27-context-all-traces.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/World/25-11-27-context-all-traces-resumption.csv"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">...1</span><span class="st">`</span>) <span class="co">#%&gt;%</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="tests" class="level2">
<h2 class="anchored" data-anchor-id="tests">Tests</h2>
<p>Sind input datei für das python-script und output des python-scripts gleich lang? Welche Lücken gibt es? Warum entstehen sie?</p>
</section>
<section id="transformations" class="level2">
<h2 class="anchored" data-anchor-id="transformations">Transformations</h2>
<p>Gruppenvariablen sind im weiteren Verarbeitungsschritt wichtig, wenn die Hashes berechnet werden. Denn die Variablen definieren dann den Umfang an Werten, die dafür berücktsichtig werden sollen. (Hier ausführen, was die verschiedenen Bedeutung sind oder später, wenn ich mir anschaue, wie die Ergebnisse der Hashes sind? Später, dann ists besser zu verstehen, aber hier verlinken, to do)</p>
<section id="group-variable-for-site-tag-group" class="level3">
<h3 class="anchored" data-anchor-id="group-variable-for-site-tag-group">group variable for site-tag-group</h3>
<p>Ein sogenannter Context kann in der Tabelle aus mehreren Zeilen bestehen, um die Information nicht zu verlieren, welche Zeilen zusammengehören und um im weiteren Verlauf aus diesen Bereichen eindeutige fingerprints erstellen zu können, findet der folgende Verarbeitungsschritt statt.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tags_context_group_indices <span class="ot">&lt;-</span> df_tags_context_ <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># head(500) %&gt;% </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sha1, context_path) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tag_group =</span> <span class="fu">row_number</span>(), <span class="at">.by =</span> <span class="fu">c</span>(sha1)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., better_path, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sha1"</span> <span class="ot">=</span> <span class="st">"sha1"</span>, <span class="st">"context_path"</span> <span class="ot">=</span> <span class="st">"attrs"</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>df_tags_context <span class="ot">&lt;-</span> df_tags_context_ <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># head(500) %&gt;% </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., tags_context_group_indices) <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># left_join(., better_path, by = c("sha1" = "sha1", "context_path" = "attrs")) %&gt;% </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_sha1_group =</span> <span class="fu">paste0</span>(sha1, <span class="st">"_"</span>, tag_group)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>context_path) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">context_path =</span> path) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="group-variable-for-month-site-subdomain" class="level3">
<h3 class="anchored" data-anchor-id="group-variable-for-month-site-subdomain">group variable for month-site-subdomain</h3>
<p>Die Erstellung dieser zusätzlichen Variable ist Ergebnis der Analyse der fingerprints, die aus der oberen Gruppenvariable entstanden sind. Diese sind sehr reaktiv, so sehr das in vielen Fällen vor allem Praktiken des Programmierens abzulesen sind und die Vermutung naheliegt, dass sie wenig zur Vermittlung in die Sphäre der Praktiken des Kommentierens beitragen können.</p>
<p>Diese Variable geht über den Horizont einzelner Bereiche hinaus und faßt für die jeweiligen Webseiten die Observationen für einen ganzen Monat zusammen.</p>
<section id="variable-erstellen-wenn-der-datensatz-der-sphere-zu-traces-context-erst-aufgebaut-wird" class="level4">
<h4 class="anchored" data-anchor-id="variable-erstellen-wenn-der-datensatz-der-sphere-zu-traces-context-erst-aufgebaut-wird">Variable erstellen, wenn der Datensatz der Sphere zu traces-context erst aufgebaut wird</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a group_id for all tags based sub_domain and month ----------------------------------</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df_sites <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con_local, <span class="fu">paste0</span>(<span class="st">"SELECT s.sha1, s.crawl_date, s.url, s.site FROM sites s WHERE s.sphere = '"</span>, SPHERE_FOR_SHEET,<span class="st">"'"</span>)) </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df_tags_timely_group <span class="ot">&lt;-</span> df_tags_context <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_sites) <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_month =</span> <span class="fu">paste0</span>(<span class="fu">year</span>(crawl_date), <span class="st">"-"</span>, <span class="fu">month</span>(crawl_date), <span class="st">"-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">ymd</span>(),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">subdomain =</span> <span class="fu">domain</span>(url) <span class="sc">%&gt;%</span> <span class="fu">suffix_extract</span>(.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(subdomain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_subdomain =</span> <span class="fu">paste</span>(site, subdomain, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_date_site_subdomain =</span> <span class="fu">paste0</span>(year_month, <span class="st">"_"</span>, site_subdomain)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>crawl_date, <span class="sc">-</span>url, <span class="sc">-</span>year_month, <span class="sc">-</span>subdomain, <span class="sc">-</span>site_subdomain, <span class="sc">-</span>site) <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sha1, tag, attr, value, text, group, tag_group, sphere, context_path, id_sha1_group, id_date_site_subdomain)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="variable-erstellen-wenn-die-daten-von-traces-context-schon-in-der-datenbank-liegen" class="level4">
<h4 class="anchored" data-anchor-id="variable-erstellen-wenn-die-daten-von-traces-context-schon-in-der-datenbank-liegen">Variable erstellen, wenn die Daten von traces-context schon in der Datenbank liegen</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a group_id for all tags based sub_domain and month ----------------------------------</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df_tags <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con, <span class="fu">paste0</span>(<span class="st">"SELECT s.crawl_date, s.url, s.site, tc.* FROM tag_context tc INNER JOIN sites s ON s.sha1 = tc.sha1 AND s.sphere = tc.sphere WHERE tc.sphere = '"</span>, SPHERE_FOR_SHEET,<span class="st">"'"</span>)) </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df_traces <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con, <span class="fu">paste0</span>(<span class="st">"SELECT s.crawl_date, s.url, s.site, tc.trace, tc.search_method, tc.search_topic, tc.search_type, tc.comment, tc.site as sha1 FROM traces tc INNER JOIN sites s ON s.sha1 = tc.site AND s.sphere = tc.sphere WHERE tc.sphere = '"</span>, SPHERE_FOR_SHEET,<span class="st">"'"</span>)) </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># df_traces %&gt;% </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   # select(-tag_context_id, -id_date_site_subdomain) %&gt;% </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(year_month = paste0(year(crawl_date), "-", month(crawl_date), "-01") %&gt;% ymd(),</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#          subdomain = domain(url) %&gt;% suffix_extract(.) %&gt;% select(subdomain) %&gt;% pull(.),</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#          site_subdomain = paste(site, subdomain, sep = "_"),</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#          id_date_site_subdomain = paste0(year_month, "_", site_subdomain)) %&gt;% View()</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>df_tags_timely_group <span class="ot">&lt;-</span> df_tags <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tag_context_id, <span class="sc">-</span>id_date_site_subdomain) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year_month =</span> <span class="fu">paste0</span>(<span class="fu">year</span>(crawl_date), <span class="st">"-"</span>, <span class="fu">month</span>(crawl_date), <span class="st">"-01"</span>) <span class="sc">%&gt;%</span> <span class="fu">ymd</span>(),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">subdomain =</span> <span class="fu">domain</span>(url) <span class="sc">%&gt;%</span> <span class="fu">suffix_extract</span>(.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(subdomain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_subdomain =</span> <span class="fu">paste</span>(site, subdomain, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_date_site_subdomain =</span> <span class="fu">paste0</span>(year_month, <span class="st">"_"</span>, site_subdomain)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>crawl_date, <span class="sc">-</span>url, <span class="sc">-</span>year_month, <span class="sc">-</span>subdomain, <span class="sc">-</span>site_subdomain, <span class="sc">-</span>site) <span class="sc">%&gt;%</span> </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sha1, tag, attr, value, value_cleaned_whitelist, text, group, tag_group, sphere, context_path, context_path_cleaned, id_sha1_group, id_date_site_subdomain)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="cleaned-value-count-based" class="level3">
<h3 class="anchored" data-anchor-id="cleaned-value-count-based">cleaned value count-based</h3>
<p>Nur für die deutsche und internationale Sphere gerechnet. Analysen und Überlegungen dazu findet sich in diesem Dokument (to do: Verlinkung)</p>
<p>Dieser Ansatz ist sehr von manueller Arbeit geprägt, dass Sprachkenntnisse unerlässlich sind, deshalb gibt es diesen Wert nicht für die nl-Sphere. Die spätere Analyse (to do: link einfügen) hat ergeben, dass diese Variante sehr viel schlechter abschneidet, als die anderen beiden, die sich auf die gleiche Gruppe beziehen.</p>
<p>Zunächst eine Analyse der Werte in der Spalte <code>value</code>, auf deren Grundlage dann das weitere Vorgehen basiert.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>attrs_to_empty_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"href"</span>, <span class="st">"title"</span>,<span class="st">"data-video-poster"</span>, <span class="st">"alt"</span>, <span class="st">"data-video-src"</span>, <span class="st">"data-video-title"</span>, <span class="st">"data-video-teaser"</span>, <span class="st">"datetime"</span>, <span class="st">"action"</span>, <span class="st">"src"</span>, <span class="st">"name"</span>, <span class="st">"srcset"</span>, <span class="st">"data-default-src"</span>, <span class="st">"data-id"</span>, <span class="st">"data-reactid"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Welche Kombinationen von Attributen und Werten kommen wie häufig vor?</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># interessant werden hier vor allem die einstelligen Einträge</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>duplicate_attr_values <span class="ot">&lt;-</span> df_tags_timely_group <span class="sc">%&gt;%</span> <span class="co">#df_tags_context %&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## auf einen Blick: welche Werte haben die einmal vorkommenden Attribute</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>individual_attrs <span class="ot">&lt;-</span> duplicate_attr_values <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(counted <span class="sc">&lt;</span> <span class="dv">100</span>, <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="co">#%&gt;% View()</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># individual_attrs  %&gt;% filter(is.na(value)) %&gt;% View()</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># duplicate_attr_values %&gt;% </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   reframe(histogram = n(), .by = counted) %&gt;% View()</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="do">## und welche Attribute haben die meisten unterschiedlichen Werte, denn ab denen würde ich mit dem Filtern ansetzen.</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>most_individual_attrs <span class="ot">&lt;-</span> duplicate_attr_values <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(counted <span class="sc">&lt;</span> <span class="dv">100</span>, <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted =</span> <span class="fu">n</span>(), <span class="at">.by =</span> attr) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(counted))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Im weiteren Verlauf wird sehr konkret auf einzelne Attribut-Value-Kombinationen eingegangen, um sie möglichst schonend von individuellen Spuren von User:innen zu reinigen. Und ja, es ist ein Reinigungsprozess oder ein Abstraktionsprozess, der hier notwendig ist.</p>
<p>Messiness in HTML-Datei: individuelle Spuren von User:innen, Praktiken des Programmierens … verschleiern die abstrakteren Praktiken des Kommentierens.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># most_individual_attrs</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(cleaning_all_content)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>cleaning_all_content <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">%in%</span> attrs_to_empty_values) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_cleaned_counted =</span> <span class="st">"value_replaced"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>cleaning_class <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"class"</span>, <span class="st">"data-in_reply_to"</span>, <span class="st">"data-bookmark"</span>, <span class="st">"aria-controls"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>), <span class="fu">str_replace_all</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">"0"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"[/]{2,}"</span>), <span class="st">"replaced_url"</span>, value_cleaned_counted),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"comment byuser comment-author-"</span>), <span class="st">"comment byuser comment-author-shortend"</span>, value_cleaned_counted),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"ee-post post-000000 post type-post status-publish format-standard has-post-thumbnail hentry category"</span>), <span class="st">"ee-post post-000000 post type-post status-publish format-standard has-post-thumbnail hentry category-shortend"</span>, value_cleaned_counted),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"elementor elementor-000000 elementor-location-single post-000000 post type-post status-publish format-standard has-post-thumbnail hentry category"</span>), <span class="st">"elementor elementor-000000 elementor-location-single post-000000 post type-post status-publish format-standard has-post-thumbnail hentry category shortend"</span>, value_cleaned_counted),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"post-000000 post type-post status-publish format-standard has-post-thumbnail category"</span>), <span class="st">"post-000000 post type-post status-publish format-standard has-post-thumbnail category shortend"</span>, value_cleaned_counted)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>cleaning_class <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">counted=</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value_cleaned_counted)) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="do">## onlick german sphere -----------------</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>cleaning_onclick <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">==</span> <span class="st">"onclick"</span>) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># head(3) %&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">url_detected =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"[</span><span class="sc">\\</span><span class="st">/]{1,}"</span>), <span class="st">"replaced_url"</span>, <span class="cn">NA</span>),</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">function_replaced =</span> <span class="fu">ifelse</span> (<span class="fu">str_detect</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">(.*$"</span>), <span class="fu">str_replace</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">(.*$"</span>, <span class="st">"_deleted"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(function_replaced), function_replaced, url_detected),</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># value_cleaned_counted = ifelse(is.na(value_cleaned_counted), value, value_cleaned_counted),</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"return rating"</span>), <span class="fu">str_replace_all</span>(value_cleaned_counted, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">"0"</span>), value_cleaned_counted),</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"follow_18"</span>), <span class="st">"follow_18_deleted"</span>, value_cleaned_counted)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>url_detected, <span class="sc">-</span>function_replaced)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="do">## onclick world sphere ------------------</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>cleaning_onclick <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">==</span> <span class="st">"onclick"</span>) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># head(3) %&gt;%</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">url_detected =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"[</span><span class="sc">\\</span><span class="st">/]{1,}"</span>), <span class="st">"replaced_url"</span>, <span class="cn">NA</span>),</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">function_replaced =</span> <span class="fu">ifelse</span> (<span class="fu">str_detect</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">(.*$"</span>), <span class="fu">str_replace</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">(.*$"</span>, <span class="st">"_deleted"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(function_replaced), function_replaced, url_detected),</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># value_cleaned_counted = ifelse(is.na(value_cleaned_counted), value, value_cleaned_counted),</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"if</span><span class="sc">\\</span><span class="st">("</span>), <span class="st">"if(replaced)"</span>, value_cleaned_counted),</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"follow_18"</span>), <span class="st">"follow_18_deleted"</span>, value_cleaned_counted),</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"document.location.href"</span>), <span class="st">"document.location.href_deleted"</span>, value_cleaned_counted),</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"javascript:.*.smh.com.au/"</span>), <span class="st">"javascript:u='http://www.smh.com.au/_deleted"</span>, value_cleaned_counted)</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>url_detected, <span class="sc">-</span>function_replaced)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>cleaning_onclick <span class="sc">%&gt;%</span> <span class="fu">filter</span>(counted <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(value_cleaned_counted)) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>cleaning_onclick<span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">counted=</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value_cleaned_counted)) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="do">## id/value german sphere --------------------------</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>cleaning_id_attrs <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(attr, <span class="st">"id|value"</span>), attr <span class="sc">!=</span> <span class="st">"width"</span>, <span class="sc">!</span>attr <span class="sc">%in%</span> attrs_to_empty_values) <span class="sc">%&gt;%</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># id_found = ifelse(str_detect(value, "(?&lt;=-|_)(?=.*?\\d)[a-z\\d]+$"), 1, NA),</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">finding =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"(?&lt;=-|_)(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d-_]{1,}$"</span>), <span class="fu">str_extract</span>(value, <span class="st">"(?&lt;=-|_)(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d-_]{1,}$"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">check_on_word =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(finding, <span class="st">"^[a-z]{1,}-"</span>), <span class="fu">str_remove</span>(finding, <span class="st">"^[a-z]{1,}-"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>         <span class="at">hash_found =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d]{1,}$"</span>), <span class="fu">str_extract</span>(value, <span class="st">"(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d]{1,}$"</span>), <span class="dv">0</span>),</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">test =</span> <span class="fu">nchar</span>(hash_found),</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">clean_id_from =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(check_on_word) <span class="sc">~</span> check_on_word,</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">is.na</span>(finding) <span class="sc">~</span> finding,</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>           test <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">~</span> hash_found</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">check_hash =</span> <span class="fu">nchar</span>(value),</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(clean_id_from), <span class="fu">str_replace</span>(value, clean_id_from, <span class="st">"id_replaced"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_cleaned_counted) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>), <span class="fu">str_replace_all</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">"0"</span>), value_cleaned_counted),</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-comments-remoteid"</span> <span class="sc">&amp;</span> check_hash <span class="sc">==</span> <span class="dv">36</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-userid"</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"bookmark"</span>), <span class="fu">str_remove_all</span>(value_cleaned_counted, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>), value_cleaned_counted),</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"[0a-fA-F]{10,10}"</span>) <span class="sc">&amp;</span> check_hash <span class="sc">==</span> <span class="dv">10</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-id-mconf"</span>, <span class="st">"replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^/"</span>), <span class="st">"url_cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^http"</span>), <span class="st">"url_cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"value"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"^[a-zA-Z</span><span class="sc">\\</span><span class="st">d-]{1,}$"</span>), <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"Schreiben Sie hier Ihren Kommentar zum Artikel|Video"</span>), <span class="st">"Schreiben Sie hier Ihren Kommentar zum Artikel/Video shortend"</span>, value_cleaned_counted),</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(check_hash <span class="sc">==</span> <span class="dv">44</span> <span class="sc">&amp;</span> attr <span class="sc">==</span> <span class="st">"value"</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^re</span><span class="sc">\\</span><span class="st">:</span><span class="sc">\\</span><span class="st">s"</span>), <span class="st">"re_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^(Thread|thread)</span><span class="sc">\\</span><span class="st">:</span><span class="sc">\\</span><span class="st">s"</span>), <span class="st">"thread_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-id"</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted)</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>finding, <span class="sc">-</span>check_on_word, <span class="sc">-</span>hash_found, <span class="sc">-</span>test, <span class="sc">-</span>clean_id_from, <span class="sc">-</span>check_hash)</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning_id_attrs %&gt;% </span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(str_detect(value_cleaned_counted, "[0a-f]{10,10}"), check_hash == 10) %&gt;% View()</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>check_on_clean_id_attrs <span class="ot">&lt;-</span> cleaning_id_attrs <span class="sc">%&gt;%</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value_cleaned_counted))</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="do">## id/value world sphere --------------------------</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>cleaning_id_attrs <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(attr, <span class="st">"id|value"</span>), attr <span class="sc">!=</span> <span class="st">"width"</span>, <span class="sc">!</span>attr <span class="sc">%in%</span> attrs_to_empty_values) <span class="sc">%&gt;%</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># id_found = ifelse(str_detect(value, "(?&lt;=-|_)(?=.*?\\d)[a-z\\d]+$"), 1, NA),</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">finding =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"(?&lt;=-|_)(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d-_]{1,}$"</span>), <span class="fu">str_extract</span>(value, <span class="st">"(?&lt;=-|_)(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d-_]{1,}$"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">check_on_word =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(finding, <span class="st">"^[a-z]{1,}-"</span>), <span class="fu">str_remove</span>(finding, <span class="st">"^[a-z]{1,}-"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">hash_found =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d]{1,}$"</span>), <span class="fu">str_extract</span>(value, <span class="st">"(?=.*?</span><span class="sc">\\</span><span class="st">d)[a-zA-Z</span><span class="sc">\\</span><span class="st">d]{1,}$"</span>), <span class="dv">0</span>),</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> <span class="fu">nchar</span>(hash_found),</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">clean_id_from =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(check_on_word) <span class="sc">~</span> check_on_word,</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(finding) <span class="sc">~</span> finding,</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>      test <span class="sc">&gt;</span> <span class="dv">16</span> <span class="sc">~</span> hash_found</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">check_hash =</span> <span class="fu">nchar</span>(value),</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(clean_id_from), <span class="fu">str_replace</span>(value, clean_id_from, <span class="st">"id_replaced"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_cleaned_counted) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>), <span class="fu">str_replace_all</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">"0"</span>), value_cleaned_counted),</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-comments-remoteid"</span> <span class="sc">&amp;</span> check_hash <span class="sc">==</span> <span class="dv">36</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-userid"</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"bookmark"</span>), <span class="fu">str_remove_all</span>(value_cleaned_counted, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>), value_cleaned_counted),</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"[0a-fA-F]{10,10}"</span>) <span class="sc">&amp;</span> check_hash <span class="sc">==</span> <span class="dv">10</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-id-mconf"</span>, <span class="st">"replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^/"</span>), <span class="st">"url_cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^http"</span>), <span class="st">"url_cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"value"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"^[a-zA-Z</span><span class="sc">\\</span><span class="st">d-]{1,}$"</span>), <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"Schreiben Sie hier Ihren Kommentar zum Artikel|Video"</span>), <span class="st">"Schreiben Sie hier Ihren Kommentar zum Artikel/Video shortend"</span>, value_cleaned_counted),</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(check_hash <span class="sc">==</span> <span class="dv">44</span> <span class="sc">&amp;</span> attr <span class="sc">==</span> <span class="st">"value"</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^re</span><span class="sc">\\</span><span class="st">:</span><span class="sc">\\</span><span class="st">s"</span>), <span class="st">"re_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^(Thread|thread)</span><span class="sc">\\</span><span class="st">:</span><span class="sc">\\</span><span class="st">s"</span>), <span class="st">"thread_replaced"</span>, value_cleaned_counted),</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-id"</span>, <span class="st">"id_replaced"</span>, value_cleaned_counted)</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>finding, <span class="sc">-</span>check_on_word, <span class="sc">-</span>hash_found, <span class="sc">-</span>test, <span class="sc">-</span>clean_id_from, <span class="sc">-</span>check_hash)</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>cleaning_rel <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span> </span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">==</span> <span class="st">"rel"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>), <span class="fu">str_replace_all</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">"0"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"TFCMS1_CMS"</span>), <span class="st">"TFCMS1_CMS_deleted"</span>, value_cleaned_counted),</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"TFVIDEO_VIDEO"</span>), <span class="st">"TFVIDEO_VIDEO_deleted"</span>, value_cleaned_counted)</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>cleaning_rel <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">counted=</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value_cleaned_counted)) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a><span class="do">### für alle zahlen vereinheitlichen (data-in_reply_to, data-bookmark,aria-controls), schwieriger fall: data-userid</span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>cleaning_datanocache <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span> </span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"data-nocache"</span>, <span class="st">"data-cache"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^.*</span><span class="sc">\\</span><span class="st">?"</span>), <span class="fu">paste0</span>(<span class="fu">str_extract</span>(value, <span class="st">"^.*</span><span class="sc">\\</span><span class="st">?"</span>),<span class="st">"_deleted"</span>), <span class="cn">NA</span>)</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>cleaning_datanocache <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">counted=</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value_cleaned_counted)) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>cleaning_dataparam <span class="ot">&lt;-</span> individual_attrs <span class="sc">%&gt;%</span> </span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"data-param"</span>, <span class="st">"data:param"</span>, <span class="st">"data-bind"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>), <span class="fu">str_replace_all</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">"0"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^.*</span><span class="sc">\\</span><span class="st">?"</span>), <span class="fu">paste0</span>(<span class="fu">str_extract</span>(value, <span class="st">"^.*</span><span class="sc">\\</span><span class="st">?"</span>),<span class="st">"_deleted"</span>), value_cleaned_counted),</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr<span class="sc">==</span> <span class="st">"data:param"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">'[{</span><span class="sc">\\</span><span class="st">"]url'</span>), <span class="st">"url: cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr<span class="sc">==</span> <span class="st">"data:param"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">'[{</span><span class="sc">\\</span><span class="st">"]title'</span>), <span class="st">"title: cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr<span class="sc">==</span> <span class="st">"data:param"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">'[{</span><span class="sc">\\</span><span class="st">"]prefix'</span>), <span class="st">"prefix: cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^.*</span><span class="sc">\\</span><span class="st">jsessionid"</span>), <span class="fu">paste0</span>(<span class="fu">str_extract</span>(value, <span class="st">"^.*</span><span class="sc">\\</span><span class="st">jsessionid"</span>)), value_cleaned_counted),</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^/"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">str_detect</span>(value, <span class="st">"^/ajaxentry"</span>), <span class="st">"url_cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"^http"</span>), <span class="st">"url_cleaned"</span>, value_cleaned_counted),</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>    <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(attr <span class="sc">==</span> <span class="st">"data-bind"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"widget.Comments|widget.Disqus"</span>), <span class="fu">paste0</span>(<span class="fu">str_extract</span>(value, <span class="st">"widget.Comments|widget.Disqus"</span>), <span class="st">"_data_replaced"</span>), value_cleaned_counted)</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>cleaning_dataparam <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">counted=</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value_cleaned_counted)) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>cleaning_style <span class="ot">&lt;-</span> duplicate_attr_values <span class="sc">%&gt;%</span> </span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">==</span> <span class="st">"style"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value, <span class="st">"url"</span>), <span class="fu">paste0</span>(<span class="fu">str_extract</span>(value, <span class="st">"^.*url"</span>), <span class="st">"_replaced"</span>), <span class="cn">NA</span>),</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_cleaned_counted),</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_replace_all</span>(value, <span class="st">"[0-9</span><span class="sc">\\</span><span class="st">.]{1,}px"</span>,<span class="st">"px_cleaned"</span>), </span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_replace_all</span>(value_cleaned_counted, <span class="st">"[0-9</span><span class="sc">\\</span><span class="st">.]{1,}px"</span>,<span class="st">"px_cleaned"</span>)),</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_cleaned_counted),</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_replace_all</span>(value, <span class="st">"[0-9</span><span class="sc">\\</span><span class="st">.]{1,}%"</span>, <span class="st">"size_cleaned"</span>), </span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_replace_all</span>(value_cleaned_counted, <span class="st">"[0-9</span><span class="sc">\\</span><span class="st">.]{1,}%"</span>, <span class="st">"size_cleaned"</span>)),</span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_cleaned_counted), </span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_replace_all</span>(value, <span class="st">"</span><span class="sc">\\</span><span class="st">#[0-9a-fA-F]{6,6}"</span>, <span class="st">"color_cleaned"</span>), </span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_replace_all</span>(value_cleaned_counted, <span class="st">"</span><span class="sc">\\</span><span class="st">#[0-9a-fA-F]{6,6}"</span>, <span class="st">"color_cleaned"</span>)</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>cleaned_attrs <span class="ot">&lt;-</span> cleaning_class <span class="sc">%&gt;%</span> </span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., cleaning_datanocache) <span class="sc">%&gt;%</span> </span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., cleaning_dataparam) <span class="sc">%&gt;%</span></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., cleaning_id_attrs) <span class="sc">%&gt;%</span> </span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., cleaning_onclick) <span class="sc">%&gt;%</span> </span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., cleaning_rel) <span class="sc">%&gt;%</span> </span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., cleaning_style) <span class="sc">%&gt;%</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(., cleaning_all_content)</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(cleaned_all_attrs)</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>duplicate_attr_values_cleaned <span class="ot">&lt;-</span> duplicate_attr_values <span class="sc">%&gt;%</span> </span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(attr <span class="sc">!=</span> <span class="st">"style"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(., cleaned_attrs) <span class="sc">%&gt;%</span> </span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_cleaned_counted), value, value_cleaned_counted)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>counted)</span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>duplicate_attr_values_cleaned_aggr <span class="ot">&lt;-</span> duplicate_attr_values_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(attr, value_cleaned_counted))</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>df_tags_context_cleaned <span class="ot">&lt;-</span> df_tags_timely_group <span class="sc">%&gt;%</span> <span class="co">#df_tags_context %&gt;% </span></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., duplicate_attr_values_cleaned) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!is.na(value)) %&gt;% </span></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_cleaned_counted =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_counted, <span class="st">"</span><span class="sc">\\</span><span class="st">d{1,}"</span>), <span class="fu">str_replace_all</span>(value_cleaned_counted, <span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">"0"</span>), value_cleaned_counted))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cleaned-value-whitelist-approach" class="level3">
<h3 class="anchored" data-anchor-id="cleaned-value-whitelist-approach">cleaned value whitelist approach</h3>
<p>Als brauchbarer hat sich herausgestellt, sich weniger an der Häufigkeit individueller Attribut-Value-Kombinationen abzuarbeiten, als viel mehr zu überlegen, welche Werte bringen für die Analyse einen tatsächlichen Mehrwert, also bei der Suche nach Praktiken des Kommentierens, und dann bei diesen noch einmal auf die Spuren von individuellen User:innen zu sehen und evtl. bereinigen.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## to do: einfacherer switch zwischen Datenquellen implementieren</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>attrs_to_be_cleaned <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"class"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>cleaned_attrs_whitelist <span class="ot">&lt;-</span> duplicate_attr_values <span class="sc">%&gt;%</span> <span class="fu">filter</span>(attr <span class="sc">%in%</span> attrs_to_be_cleaned) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_check =</span> <span class="fu">str_detect</span>(value, <span class="st">"[a-fA-F0-9-_]{1,}$"</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">detected =</span> <span class="fu">str_extract</span>(value, <span class="st">"[a-fA-F0-9-_]{1,}$"</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">digits_found =</span> <span class="fu">str_detect</span>(detected, <span class="st">"[</span><span class="sc">\\</span><span class="st">d]{1,}"</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_whitelist =</span> <span class="fu">ifelse</span>(id_check <span class="sc">&amp;</span> digits_found, <span class="fu">str_replace</span>(value, detected, <span class="st">"id_replaced"</span>), <span class="cn">NA</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_whitelist =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value_cleaned_whitelist), value, value_cleaned_whitelist),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_whitelist =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_whitelist, <span class="st">"comment byuser comment-author"</span>), <span class="st">"comment byuser comment-author"</span>, value_cleaned_whitelist),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">value_cleaned_whitelist =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(value_cleaned_whitelist, <span class="st">"[</span><span class="sc">\\</span><span class="st">d]{1,}"</span>), <span class="fu">str_replace_all</span>(value_cleaned_whitelist, <span class="st">"[</span><span class="sc">\\</span><span class="st">d]{1,}"</span>, <span class="st">"0"</span>), value_cleaned_whitelist)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>         ) <span class="co">#%&gt;% View()</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>duplicate_attr_values_cleaned_whitelist <span class="ot">&lt;-</span> duplicate_attr_values <span class="sc">%&gt;%</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>attr <span class="sc">%in%</span> attrs_to_be_cleaned) <span class="sc">%&gt;%</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(., cleaned_attrs_whitelist) <span class="sc">%&gt;%</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!is.na(value)) %&gt;% </span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>counted, <span class="sc">-</span>id_check, <span class="sc">-</span>digits_found, <span class="sc">-</span>detected) </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>df_tags_context_cleaned_whitelist <span class="ot">&lt;-</span> df_tags_timely_group <span class="sc">%&gt;%</span> <span class="co">#df_tags_context_cleaned %&gt;% #df_tags_context %&gt;% </span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!is.na(value)) %&gt;% </span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., duplicate_attr_values_cleaned_whitelist) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cleaned-pathes-on-whitelist-value-cleaned" class="level3">
<h3 class="anchored" data-anchor-id="cleaned-pathes-on-whitelist-value-cleaned">cleaned pathes on whitelist value cleaned</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>site_info <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con_local, <span class="fu">paste0</span>(<span class="st">"SELECT s.sha1, s.url, s.site FROM sites s WHERE s.of_interest = 'true' AND s.sphere = '"</span>, SPHERE_FOR_SHEET, <span class="st">"'"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subdomain =</span> urltools<span class="sc">::</span><span class="fu">domain</span>(url) <span class="sc">%&gt;%</span> <span class="fu">suffix_extract</span>(.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(subdomain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_subdomain =</span> <span class="fu">paste</span>(site, subdomain, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>(.))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>prep_pathes_whitelist <span class="ot">&lt;-</span> df_tags_context_cleaned_whitelist <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., site_info) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_subdomain, context_path, id_sha1_group, tag, attr, value_cleaned_whitelist) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(site_subdomain, id_sha1_group, context_path, sha1, sphere) %&gt;% </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(site_subdomain, context_path) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path_tag_group=</span> <span class="fu">row_number</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, context_path, id_sha1_group, tag)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path_subdomain_group =</span> <span class="fu">row_number</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, context_path, id_sha1_group)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(path_tag_group <span class="sc">==</span> path_subdomain_group)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>pathes_whitelist <span class="ot">&lt;-</span> prep_pathes_whitelist <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">attr_whitelist =</span> <span class="fu">paste0</span>(attr,<span class="st">" : "</span>, value_cleaned_whitelist), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, context_path, id_sha1_group, tag)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">attrs_whitelist =</span> <span class="fu">paste</span>(attr_whitelist, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, context_path, id_sha1_group, tag)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">context_path_cleaned =</span> <span class="fu">paste0</span>(tag, <span class="st">" {"</span>, attrs_whitelist, <span class="st">"}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tag, <span class="sc">-</span>attrs_whitelist) <span class="sc">%&gt;%</span> </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="co">#%&gt;% View()</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>df_tags_pathes_whitelist <span class="ot">&lt;-</span> df_tags_context_cleaned_whitelist <span class="sc">%&gt;%</span> </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., site_info) <span class="sc">%&gt;%</span> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., pathes_whitelist) <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url, <span class="sc">-</span>site, <span class="sc">-</span>subdomain, <span class="sc">-</span>site_subdomain)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Korrektur von alten context pfaden auf neue </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>tbl_tags_context <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con_local, <span class="fu">paste0</span>(<span class="st">"SELECT s.sha1, s.tag, s.attr, s.value, s.text, s.group, s.tag_group, s.sphere, s.context_path, s.id_sha1_group, s.id_date_site_subdomain, s.value_cleaned_counted, s.value_cleaned_whitelist FROM traces_context s WHERE s.sphere = '"</span>, SPHERE_FOR_SHEET, <span class="st">"'"</span>)) </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>mini_df_tags_pathes_whitelist <span class="ot">&lt;-</span> df_tags_pathes_whitelist <span class="sc">%&gt;%</span> <span class="fu">select</span>(id_sha1_group, context_path_cleaned) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>update_tbl_tags_context <span class="ot">&lt;-</span> tbl_tags_context <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., mini_df_tags_pathes_whitelist)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## DELETE FROM traces_context WHERE sphere='German';</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(<span class="at">conn =</span> con_local, <span class="at">name =</span> <span class="st">"traces_context"</span>, <span class="at">value =</span> update_tbl_tags_context, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(update_tbl_tags_context, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/"</span>,SPHERE_FOR_SHEET,<span class="st">"/25-12-08-update_tbl_tags_context.RData"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="output" class="level2">
<h2 class="anchored" data-anchor-id="output">Output</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>SPHERE_FOR_SHEET <span class="ot">&lt;-</span> <span class="st">"Dutch"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/"</span>,SPHERE_FOR_SHEET, <span class="st">"/25-12-03-tags-pathes-cleaned.RData"</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(<span class="at">conn =</span> con_local, <span class="at">name =</span> <span class="st">"traces_context"</span>, <span class="at">value =</span> df_tags_pathes_cleaned_nl, <span class="at">append =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="appendix-schritte-zur-überprüfungen-erster-parsing-ansätze." class="level2">
<h2 class="anchored" data-anchor-id="appendix-schritte-zur-überprüfungen-erster-parsing-ansätze.">Appendix: Schritte zur Überprüfungen erster Parsing-Ansätze.</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"../../../data/1-parsing/tags-context/Dutch/25-12-03-tags-pathes-cleaned.RData"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>just_time_index <span class="ot">&lt;-</span> df_tags_timely_group <span class="sc">%&gt;%</span> <span class="fu">select</span>(id_date_site_subdomain)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df_tags_pathes_cleaned_nl <span class="ot">&lt;-</span> df_tags_pathes_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(., just_time_index)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>df_tags_pathes_cleaned <span class="ot">&lt;-</span> df_tags_pathes_cleaned_nl</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df_tags_pathes_cleaned, <span class="at">file=</span><span class="st">"../../../data/1-parsing/tags-context/Dutch/25-12-04-tags-pathes-cleaned.RData"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>df_nl <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con_local, <span class="fu">paste0</span>(<span class="st">"SELECT * FROM traces_context s WHERE s.sphere = '"</span>, SPHERE_FOR_SHEET,<span class="st">"'"</span>)) </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>df_nl_hashes <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con_local, <span class="fu">paste0</span>(<span class="st">"SELECT * FROM context_hashed s WHERE s.sphere = '"</span>, SPHERE_FOR_SHEET,<span class="st">"' AND s.iteration='date_site_subdomain'"</span>)) </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(df_tags_pathes_cleaned_nl)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"../../../data/1-parsing/tags-context/World/25-12-03-tags-pathes-cleaned.RData"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="erste-variante-von-vereinfachten-pfaden-cleaned-pathes-of-tags" class="level3">
<h3 class="anchored" data-anchor-id="erste-variante-von-vereinfachten-pfaden-cleaned-pathes-of-tags">Erste Variante von vereinfachten Pfaden: cleaned pathes of tags</h3>
<p>Eine Vermutung ist, dass die Pfade der Kontextblöcke bei der Analyse unterstützend wirken könnten. Bisher (Stand Winter 2025) werden die vereinfachten Pfade vor allem zum Zeichnen der Spuren verwendet. Aber auch hier besteht das Problem, wie oben beschrieben. Denn die Werte, die oben vereinfacht werden, sind in vollständigen Pfaden, in den diese Werte vorkommen natürlich auch enthalten.</p>
<p>Diese Passage ist sehr rechenintensiv, deshalb werden zwischendurch Datensätze immer wieder auf Festplatte geschrieben, um zu verhindern, dass wenn sich die Umgebung zwischendurch aufhängt, Ergebnisse bisheriger Rechenprozesse hinfällig werden.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>site_info <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> con_local, <span class="fu">paste0</span>(<span class="st">"SELECT s.sha1, s.url, s.site FROM sites s WHERE s.of_interest = 'true' AND s.sphere = '"</span>, SPHERE_FOR_SHEET, <span class="st">"'"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subdomain =</span> urltools<span class="sc">::</span><span class="fu">domain</span>(url) <span class="sc">%&gt;%</span> <span class="fu">suffix_extract</span>(.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(subdomain) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">site_subdomain =</span> <span class="fu">paste</span>(site, subdomain, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.character</span>(.))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>pathes <span class="ot">&lt;-</span> df_tags_context <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., site_info) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_subdomain, context_path) <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(site_subdomain, id_sha1_group, context_path, sha1, sphere) %&gt;% </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(site_subdomain, context_path) <span class="co">#%&gt;% #View()</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(pathes, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/"</span>, SPHERE_FOR_SHEET, <span class="st">"/25-12-03-pathes.RData"</span>))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library(furrr)</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># future::plan(multisession)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>subdomains <span class="ot">&lt;-</span> pathes <span class="sc">%&gt;%</span> <span class="fu">select</span>(site_subdomain) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>pathes_sim_alternative <span class="ot">&lt;-</span> <span class="fu">map_df</span>(subdomains, <span class="cf">function</span>(i){</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># pathes_sim_alternative &lt;- future_map(subdomains, function(i){</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> pathes <span class="sc">%&gt;%</span> </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(site_subdomain <span class="sc">==</span> i) <span class="sc">%&gt;%</span> </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group_ =</span> <span class="fu">str_extract</span>(context_path, <span class="st">"([a-zA-Z_</span><span class="sc">\\</span><span class="st">{</span><span class="sc">\\</span><span class="st">}</span><span class="sc">\\\\\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">]</span><span class="sc">\\\"\\</span><span class="st">'</span><span class="sc">\\</span><span class="st">:</span><span class="sc">\\</span><span class="st">-0-9</span><span class="sc">\\</span><span class="st">/</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">,</span><span class="sc">\\</span><span class="st">_]{1,}</span><span class="sc">\\</span><span class="st">s?){1,3}"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group_ =</span> <span class="fu">str_replace_all</span>(group_, <span class="st">"[0-9]{1,}"</span>, <span class="st">"0"</span>))</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(df, <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/"</span>, SPHERE_FOR_SHEET, <span class="st">"/25-12-03-cleaned-pathes-alternative.csv"</span>), <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>}, <span class="at">.progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># pathes_sim_alternative_ &lt;- read_csv(paste0("../../../data/1-parsing/tags-context/", SPHERE_FOR_SHEET, "/25-12-03-cleaned-pathes-alternative.csv"), col_names = c("site_subdomain", "context_path", "group_"), show_col_types = FALSE)</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>pathes_sim_agg <span class="ot">&lt;-</span> pathes_sim_alternative <span class="sc">%&gt;%</span> <span class="co">#flatten() %&gt;% </span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted_pathes =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, group_))</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>pathes_overview_alt <span class="ot">&lt;-</span> pathes_sim_agg <span class="sc">%&gt;%</span> </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">pathes_pro_site =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain))</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>pathes_sim_pathes <span class="ot">&lt;-</span> pathes_sim_alternative <span class="sc">%&gt;%</span> </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., pathes_sim_agg) <span class="sc">%&gt;%</span> </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">context_path_group =</span> <span class="fu">ifelse</span>(counted_pathes <span class="sc">&gt;</span><span class="dv">1</span>, group_, context_path))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">World</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">German</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Dutch</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### World Sphere-----------------------------------------------------</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>pathes_sim_simpler <span class="ot">&lt;-</span> pathes_sim_alternative <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># group_ = str_extract(group_, "([a-zA-Z\\{\\}\\\\\\[\\]\\\"\\'\\s\\-0-9\\/\\.\\,\\_]{1,}\\:){1,3}"),</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"'gigyaCommentPlugin-mirror"</span>), <span class="fu">paste0</span>(group_, <span class="st">"'gigyaCommentPlugin-mirror"</span>), group_),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"body </span><span class="sc">\\</span><span class="st">{'data-tracking': '</span><span class="sc">\\</span><span class="st">{</span><span class="sc">\"</span><span class="st">isEnabled</span><span class="sc">\"</span><span class="st">:true,"</span>), <span class="st">"body {'data-tracking': '{isEnabled:true,"</span>, group_),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"'onclick': </span><span class="sc">\"</span><span class="st">wp_pb</span><span class="sc">\\</span><span class="st">.report</span><span class="sc">\\</span><span class="st">('comments'"</span>), <span class="fu">paste0</span>(group_,  <span class="st">"onclick': 'wp_pb.report(comments)"</span>), group_),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'data-api-url':"</span>), <span class="fu">paste0</span>(group_, <span class="st">"div {'data-api-url':"</span>), group_),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'data-content'"</span>), <span class="fu">paste0</span>(group_, <span class="st">"div {'data-content'"</span>), group_),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(group_, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'class': </span><span class="sc">\\</span><span class="st">['sc"</span>), <span class="st">"div {'class': ['sc"</span>, group_),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">str_replace_all</span>(group_, <span class="st">"[0-9]{1,}"</span>, <span class="st">"0"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">context_path_cleaned =</span> group_)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>pathes_sim_agg_simpler <span class="ot">&lt;-</span> pathes_sim_simpler <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted_pathes =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, context_path_cleaned)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(counted_pathes))</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>pathes_overview_simpler <span class="ot">&lt;-</span> pathes_sim_agg_simpler <span class="sc">%&gt;%</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">pathes_pro_site =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pathes_pro_site))</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>df_tags_pathes_cleaned <span class="ot">&lt;-</span> df_tags_context_cleaned_whitelist <span class="sc">%&gt;%</span> </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., site_info) <span class="sc">%&gt;%</span> </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., pathes_sim_simpler) <span class="sc">%&gt;%</span> </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url, <span class="sc">-</span>site, <span class="sc">-</span>subdomain, <span class="sc">-</span>site_subdomain) <span class="sc">%&gt;%</span> </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df_tags_pathes_cleaned, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/World/25-12-03-tags-pathes-cleaned.RData"</span>))</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># dbWriteTable(conn = con, name = "tag_context", value = df_tags_pathes_cleaned, append = TRUE)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### German Sphere-----------------------------------------------------</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>pathes_sim_simpler <span class="ot">&lt;-</span> pathes_sim_alternative <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['Headline'</span><span class="sc">\\</span><span class="st">], 'title'"</span>), <span class="st">"group_1885"</span>, group_),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['MediaLink'</span><span class="sc">\\</span><span class="st">], 'title'"</span>), <span class="st">"group_3"</span>, group_),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">['RightBox'</span><span class="sc">\\</span><span class="st">], 'mysiteshow"</span>), <span class="st">"group_10"</span>, group_),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['fb-share-button'"</span>), <span class="st">"group_16"</span>, group_),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['g-plusone'"</span>), <span class="st">"group_49"</span>, group_),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['js-adobe-digital-data'"</span>), <span class="st">"group_59"</span>, group_),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['sharebuttons'"</span>), <span class="st">"group_307"</span>, group_),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"faz_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"span </span><span class="sc">\\</span><span class="st">{'title'"</span>), <span class="st">"group_2119"</span>, group_),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"handelsblatt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'class': </span><span class="sc">\\</span><span class="st">['commentBox'</span><span class="sc">\\</span><span class="st">]</span><span class="sc">\\</span><span class="st">}"</span>), <span class="st">"group_1709"</span>, group_),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"handelsblatt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['hcf-google-buzz-button', 'ajaxify'</span><span class="sc">\\</span><span class="st">]"</span>), <span class="st">"group_1739"</span>, group_),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"handelsblatt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'type'</span><span class="sc">\\</span><span class="st">: 'text/javascript', 'src'</span><span class="sc">\\</span><span class="st">: '/preparesite/empty</span><span class="sc">\\</span><span class="st">.js"</span>), <span class="st">"group_1773"</span>, group_),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"sueddeutsche_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['commentbottom"</span>), <span class="st">"group_8"</span>, group_),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"sueddeutsche_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'id'</span><span class="sc">\\</span><span class="st">: 'comments', 'data-token'"</span>), <span class="st">"group_21"</span>, group_),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"sueddeutsche_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'id'</span><span class="sc">\\</span><span class="st">: 'disqus_thread', 'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['disqus-container'</span><span class="sc">\\</span><span class="st">]"</span>), <span class="st">"group_26"</span>, group_),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"sueddeutsche_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'id'</span><span class="sc">\\</span><span class="st">: 'taboola-feed-below-article', 'data-overline'"</span>), <span class="st">"group_112"</span>, group_),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"focus_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['OUTBRAIN'</span><span class="sc">\\</span><span class="st">], 'data-src'</span><span class="sc">\\</span><span class="st">: '"</span>), <span class="st">"group_853"</span>, group_),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"focus_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['fb-like'</span><span class="sc">\\</span><span class="st">], 'data-href'"</span>), <span class="st">"group_889"</span>, group_),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"focus_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'data-button-shape'</span><span class="sc">\\</span><span class="st">: 'square', 'data-lang'"</span>), <span class="st">"group_905"</span>, group_),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"focus_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"a </span><span class="sc">\\</span><span class="st">{'href'</span><span class="sc">\\</span><span class="st">: '"</span>), <span class="st">"group_1"</span>, group_),</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"hna_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'class': </span><span class="sc">\\</span><span class="st">['idComment', 'idJSComponent'"</span>), <span class="st">"group_3"</span>, group_),</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"hna_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'data-id-module'</span><span class="sc">\\</span><span class="st">: 'facebook', 'data-id-mconf'"</span>), <span class="st">"group_96"</span>, group_),</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"hna_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'data-id-module'</span><span class="sc">\\</span><span class="st">: 'twitter', 'data-id-mconf'"</span>), <span class="st">"group_116"</span>, group_),</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"hna_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'data-widget'</span><span class="sc">\\</span><span class="st">: 'plista_widget_belowArticle_rwd'"</span>), <span class="st">"group_132"</span>, group_),</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"hna_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'id'</span><span class="sc">\\</span><span class="st">: 'plista_widget_belowArticle_rwd', 'data-id-modul"</span>), <span class="st">"group_410"</span>, group_),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"badische-zeitung_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"form </span><span class="sc">\\</span><span class="st">{'id': 'login_embed', 'enctype': 'multipart</span><span class="sc">\\</span><span class="st">/form-d"</span>), <span class="st">"group_6"</span>, group_),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"badische-zeitung_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"iframe </span><span class="sc">\\</span><span class="st">{'src': 'http://www.facebook.com/plugins/like"</span>), <span class="st">"group_156"</span>, group_),</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>         <span class="co"># group_ = ifelse(site_subdomain == "badische-zeitung_www" &amp; str_detect(context_path, "\\{'class'\\: \\['comment__list'"), "group_47", group_),</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>         <span class="co"># group_ = ifelse(site_subdomain == "badische-zeitung_www" &amp; str_detect(context_path, "\\{'id'\\: 'login_embed', 'enctype'\\: 'multipart/form-data'"), "group_213", group_),</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"freitag_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"form </span><span class="sc">\\</span><span class="st">{'id'</span><span class="sc">\\</span><span class="st">: 'article-comment', 'action'</span><span class="sc">\\</span><span class="st">: "</span>), <span class="st">"group_1738"</span>, group_),</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"jungefreiheit_NA"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"article </span><span class="sc">\\</span><span class="st">{'class': </span><span class="sc">\\</span><span class="st">['post-</span><span class="sc">\\</span><span class="st">d{6,6}', 'post', 'type-post', 'status-pu"</span>), <span class="st">"group_1"</span>, group_),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"jungefreiheit_NA"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'data-elementor-type'</span><span class="sc">\\</span><span class="st">: 'single', 'data-elementor-id"</span>), <span class="st">"group_60"</span>, group_),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"jungefreiheit_NA"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"form </span><span class="sc">\\</span><span class="st">{'method': 'post', 'enctype': 'multipart/form-data"</span>), <span class="st">"group_117"</span>, group_),</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"jungefreiheit_NA"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'href'</span><span class="sc">\\</span><span class="st">: 'https</span><span class="sc">\\</span><span class="st">://jungefreiheit.de/debatte/kommentar/"</span>), <span class="st">"group_1597"</span>, group_),</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"jungefreiheit_NA"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"script </span><span class="sc">\\</span><span class="st">{'type': 'text/javascript', 'src': 'http://jungefreih"</span>), <span class="st">"group_136"</span>, group_),</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"welt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['fb-like'</span><span class="sc">\\</span><span class="st">], 'data-href'</span><span class="sc">\\</span><span class="st">: 'http</span><span class="sc">\\</span><span class="st">://www.welt.de/"</span>), <span class="st">"group_9"</span>, group_),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"welt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['fb-like'</span><span class="sc">\\</span><span class="st">], 'data-layout'</span><span class="sc">\\</span><span class="st">: 'button_count', 'data-"</span>), <span class="st">"group_43"</span>, group_),</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"welt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'class': </span><span class="sc">\\</span><span class="st">['widget', 'disqus', 'articleComments'"</span>), <span class="st">"group_73"</span>, group_),</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"welt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'id'</span><span class="sc">\\</span><span class="st">: 'gplus-button-inline', 'class'</span><span class="sc">\\</span><span class="st">: </span><span class="sc">\\</span><span class="st">['g-plusone'</span><span class="sc">\\</span><span class="st">], 'data"</span>), <span class="st">"group_89"</span>, group_),</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"welt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'id': 'readcomments'</span><span class="sc">\\</span><span class="st">}"</span>), <span class="st">"group_130"</span>, group_),</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"welt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"div </span><span class="sc">\\</span><span class="st">{'id': 'recommend', 'class': </span><span class="sc">\\</span><span class="st">['articleBox', 'commentB"</span>), <span class="st">"group_131"</span>, group_),</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"welt_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"</span><span class="sc">\\</span><span class="st">{'id'</span><span class="sc">\\</span><span class="st">: 'poll-</span><span class="sc">\\</span><span class="st">d{9,9}', 'action': 'http://www.welt.de/"</span>), <span class="st">"group_356"</span>, group_),</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(site_subdomain <span class="sc">==</span> <span class="st">"rp-online_www"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(context_path, <span class="st">"form </span><span class="sc">\\</span><span class="st">{'action': '/public/comments/preview"</span>), <span class="st">"form {'action': '/public/comments/preview"</span>, group_)<span class="co">#,</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>         <span class="co"># group_ = ifelse(site_subdomain == "welt_www" &amp; str_detect(context_path, "\\{'id'\\: 'poll-\\d{9,9}', 'action': 'http://www.welt.de/"), "group_20498", group_)#,</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>         ) </span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>pathes_sim_agg_simpler <span class="ot">&lt;-</span> pathes_sim_simpler <span class="sc">%&gt;%</span> </span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted_pathes =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, group_))</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>pathes_overview_simpler <span class="ot">&lt;-</span> pathes_sim_agg_simpler <span class="sc">%&gt;%</span> </span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">pathes_pro_site =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain))</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>pathes_sim_simpler_join <span class="ot">&lt;-</span> pathes_sim_simpler <span class="sc">%&gt;%</span> </span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">context_path_cleaned =</span> group_)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>pathes_sim_simpler_join <span class="sc">%&gt;%</span> <span class="fu">select</span>(context_path) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>df_tags_pathes_cleaned <span class="ot">&lt;-</span> df_tags_context_cleaned_whitelist <span class="sc">%&gt;%</span> </span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., site_info) <span class="sc">%&gt;%</span> </span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., pathes_sim_simpler) <span class="sc">%&gt;%</span> </span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url, <span class="sc">-</span>site, <span class="sc">-</span>subdomain, <span class="sc">-</span>site_subdomain, <span class="at">context_path_cleaned =</span> group_)</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df_tags_pathes_cleaned, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/German/25-12-03-tags-pathes-cleaned.RData"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pathes_sim_simpler <span class="ot">&lt;-</span> pathes_sim_alternative <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># group_ = str_extract(group_, "([a-zA-Z\\{\\}\\\\\\[\\]\\\"\\'\\s\\-0-9\\/\\.\\,\\_]{1,}\\:){1,3}"),</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"script </span><span class="sc">\\</span><span class="st">{'src': 'https:</span><span class="sc">\\</span><span class="st">/</span><span class="sc">\\</span><span class="st">/cdns</span><span class="sc">\\</span><span class="st">.gigya</span><span class="sc">\\</span><span class="st">.com</span><span class="sc">\\</span><span class="st">/js</span><span class="sc">\\</span><span class="st">/gigya</span><span class="sc">\\</span><span class="st">.js"</span>), <span class="st">"script {'src': 'https://cdns.gigya.com/js/gigya.js"</span>, group_),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"gigya-comments'"</span>), <span class="fu">paste0</span>(group_, <span class="st">" gigya-comments"</span>), group_),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"comments-counter"</span>), <span class="fu">paste0</span>(group_,  <span class="st">"comments-counter"</span>), group_),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(context_path, <span class="st">"disqus_thread'</span><span class="sc">\\</span><span class="st">}"</span>), <span class="fu">paste0</span>(group_, <span class="st">"disqus_thread"</span>), group_),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>         <span class="co"># group_ = ifelse(str_detect(context_path, "div \\{'data-content'"), paste0(group_, "div {'data-content'"), group_),</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>         <span class="co"># group_ = ifelse(str_detect(group_, "div \\{'class': \\['sc"), "div {'class': ['sc", group_),</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_ =</span> <span class="fu">str_replace_all</span>(group_, <span class="st">"[0-9]{1,}"</span>, <span class="st">"0"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">context_path_cleaned =</span> group_) <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_subdomain <span class="sc">%in%</span> subdomains)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>pathes_sim_agg_simpler <span class="ot">&lt;-</span> pathes_sim_simpler <span class="sc">%&gt;%</span> </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">counted_pathes =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain, context_path_cleaned)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(counted_pathes))</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>pathes_overview_simpler <span class="ot">&lt;-</span> pathes_sim_agg_simpler <span class="sc">%&gt;%</span> </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">pathes_pro_site =</span> <span class="fu">n</span>(), <span class="at">.by =</span> <span class="fu">c</span>(site_subdomain)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pathes_pro_site)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(site_subdomain <span class="sc">%in%</span> subdomains)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>df_tags_pathes_cleaned <span class="ot">&lt;-</span> df_tags_context_cleaned_whitelist <span class="sc">%&gt;%</span> </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., site_info) <span class="sc">%&gt;%</span> <span class="co">#View()</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., pathes_sim_simpler) <span class="sc">%&gt;%</span> </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>url, <span class="sc">-</span>site, <span class="sc">-</span>subdomain, <span class="sc">-</span>site_subdomain) <span class="sc">%&gt;%</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_cleaned_counted =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df_tags_pathes_cleaned, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"../../../data/1-parsing/tags-context/Dutch/25-12-03-tags-pathes-cleaned.RData"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="parsing-test-context" class="level2">
<h2 class="anchored" data-anchor-id="parsing-test-context">Parsing Test context</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>